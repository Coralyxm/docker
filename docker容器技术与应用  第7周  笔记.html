<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/607017 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="790"/>
<h1>docker容器技术与应用  第7周  笔记</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2023/3/27 15:08</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2023/3/27 15:08</i></td></tr>
<tr><td><b>作者：</b></td><td><i>程露</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><div><span style="font-size: 18pt; font-weight: bold;">项目三  Docker Compose容器编排技术</span></div><div><br/></div><div><br/></div><div><span style="font-size: 21.3333px; color: rgb(209, 0, 255); font-style: italic; font-weight: bold;">任务一：Docker Compose入门</span></div><div><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">一、什么是容器编排技术？</span></div><div><span style="font-size: 18.6667px; font-weight: bold;">     </span> <span style="font-size: 18.6667px;"> 容器编排指</span><span style="font-size: 18.6667px;">对多个容器进行组织，使其能够按照计划运行的流程。在现代应用程序开发中，整体式的应用早已成为过去时，如今的应用由数十乃至上百个松散结合的容器式组件构成，而这些组件需要通过相互之间的协同合作，才能使既定的应用按照设计运作，这种设计组成了容器编排技术。</span></div><div><span style="font-size: 18.6667px;">       如今，主流的容器编排技术有：</span><span style="font-size: 18.6667px; color: rgb(255, 0, 0); font-weight: bold;">Docker compose（适合单机容器编排）、Docker Swarm（适合多机容器编排）、Docker Machine（适合多平台容器编排）</span><span style="font-size: 18.6667px;">。</span><img src="docker容器技术与应用  第7周  笔记_files\en_todo.png"/><span style="font-size: 14pt; color: rgb(255, 255, 255); font-family: unset; font-weight: bold;">画图解释</span></div><div><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">二、</span><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">为什么要学习Docker Compose？</span></div><div><span style="font-size: 18.6667px; font-weight: bold;">     </span> <span style="font-size: 18.6667px;"> 1、许多应用程序通过多个更小的服务互相协同来构成一个完整可用的项目，如一个订单应用程序可能包括web前端、订单处理程序和后台数据库等多个服务，相当于一个简单的微服务架构。这种架构很适合使用容器实现，每个服务由一个容器承载，</span><span style="font-size: 18.6667px; color: rgb(255, 0, 0);">一台计算机</span><span style="font-size: 18.6667px;">同时运行多个容器就能部署整个应用程序。</span></div><div><span style="font-size: 18.6667px;">       2、仅使用docker命令部署和管理这类多容器应用程序，往往需要编写若干个脚本文件，使用的命令可能会显得冗长且复杂，包含大量的选项和参数，容易发生错误，于是，Docker的公司使用Docker Compose这个多容器部署管理工具来</span><span style="font-size: 18.6667px;">为解决这个问题</span><span style="font-size: 18.6667px;">。</span></div><div><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">三、什么是</span><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">Docker Compose？</span></div><div><span style="font-size: 18.6667px; font-weight: bold;">     </span> <span style="font-size: 18.6667px;"> Docker Compose是Docker官方的</span><span style="font-size: 18.6667px; color: rgb(255, 0, 0);">开源</span><span style="font-size: 18.6667px;">项目，它</span><span style="font-size: 18.6667px;">并不是通过脚本和各种docker命令将多个容器组织起来，而是</span><span style="font-size: 18.6667px;">通过一个</span><span style="font-size: 18.6667px; color: rgb(255, 0, 0);">声明式的配置文件</span><span style="font-size: 18.6667px;">描述整个应用程序，</span><span style="font-size: 18.6667px;">让用户使用一条</span><span style="font-size: 18.6667px; color: rgb(255, 0, 0);">docker-compose命令</span><span style="font-size: 18.6667px;">即可完成整个应用程序的部署，它</span><span style="font-size: 18.6667px;">将逻辑关联的多个容器编排为一个整体进行统一管理，</span><span style="font-size: 18.6667px;">从而</span><span style="font-size: 18.6667px;">提高了应用程序的部署效率</span><span style="font-size: 18.6667px;">。</span></div><div><br/></div><div><br/></div><div><span style="font-size: 21.3333px; color: rgb(209, 0, 255); font-style: italic; font-weight: bold;">任务二：使用Docker Compose编排容器</span></div><div><span style="font-size: 21.3333px;">使用Docker Compose技术来编排容器主要有以下三个步骤：</span></div><div><span style="font-size: 14pt;">1、</span><span style="font-size: 14pt;">安装Docker Compose</span></div><div><span style="font-size: 14pt;">2、编写Compose文件</span></div><div><span style="font-size: 14pt;">3、使用Docker Compose命令部署和管理应用程序</span></div><div><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">任务2.1：安装Docker Compose</span></div><div><span style="font-size: 14pt;">    1）去官网下载二进制文件进行安装：</span></div><div><span style="font-size: 14pt;">    wget </span><a href="https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-linux-x86_64" style="font-size: 14pt;">https://github.com/docker/compose/releases/download/v2.5.0/docker-compose-linux-x86_64</a></div><div><span style="font-size: 14pt;">    2）给二进制文件可执行权限</span></div><div><span style="font-size: 14pt;">    chmod  +x  docker-compose-Linux-x86_64</span></div><div><span style="font-size: 14pt;">    3）给二进制文件重命名为docker-compose</span></div><div><span style="font-size: 14pt;">    mv   docker-compose-Linux-x86_64   /usr/local/bin/docker-compose</span></div><div><span style="font-size: 14pt;">    4）查看docker-compose的版本</span></div><div><span style="font-size: 14pt;">    docker-compose  --version</span></div><div><span style="font-size: 14pt;">    -&gt; 结果可以看到版本和ID就证明安装好了</span></div><div><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">任务2.2：编写Compose文件</span></div><div><span style="font-size: 14pt; font-weight: bold;">一、什么是Compose文件？</span></div><div><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">     </span> <span style="font-size: 14pt;"> Compose文件是Docker Compose的配置文件，也可以理解为是容器编排的模板文件，它用于定义整个应用程序的运行模式，包括服务、网络和卷。Compose文件是一种文本文件，采用YAML格式，可以使用.yml或者.yaml作为文件扩展名，默认的文件名为docker-compose.yml或者docker-compose.yaml。</span></div><div><span style="font-size: 14pt; font-weight: bold;">二、YAML文件格式是怎样的？</span></div><div><span style="font-size: 18.6667px; color: rgb(255, 0, 0); font-weight: bold;">特点：</span></div><ul><li><div><span style="font-size: 18.6667px;">大小写敏感</span></div></li><li><div><span style="font-size: 18.6667px;">使用缩进表示层级关系，且缩进不能使用tab，只能使用空格</span></div></li><li><div><span style="font-size: 18.6667px;">相同层级的缩进应相同</span></div></li><li><div><span style="font-size: 18.6667px;">可以使用#表示注释行</span></div></li><li><div><span style="font-size: 18.6667px;">每个冒号与后面的参数之间都要有一个空格</span></div></li><li><div><span style="font-size: 18.6667px;">每行末尾也要有一个空格</span></div></li></ul><div><span style="font-size: 18.6667px; color: rgb(255, 0, 0); font-weight: bold;">Compose文件包含4个节：</span></div><ul><li><div><span style="font-size: 18.6667px;">version节（</span><span style="font-size: 18.6667px;">必须项</span><span style="font-size: 18.6667px;">）</span></div></li><li><div><span style="font-size: 18.6667px;">services节</span><span style="font-size: 18.6667px;">（</span><span style="font-size: 18.6667px;">必须项</span><span style="font-size: 18.6667px;">）</span></div></li><li><div><span style="font-size: 18.6667px;">networks节（</span><span style="font-size: 18.6667px;">非必须项</span><span style="font-size: 18.6667px;">）</span></div></li><li><div><span style="font-size: 18.6667px;">volumes节</span><span style="font-size: 18.6667px;">（</span><span style="font-size: 18.6667px;">非必须项</span><span style="font-size: 18.6667px;">）   </span></div></li></ul><div><span style="font-size: 18.6667px; color: rgb(255, 0, 0); font-weight: bold;">version节：</span></div><ul><li><div><span style="font-size: 18.6667px;">使用最新版本，version： ‘3’</span></div></li></ul><div><span style="font-weight: bold; font-size: 18.6667px; color: rgb(255, 0, 0); font-family: unset;">services节的常用配置项：</span></div><ul><li><div><span style="font-size: 18.6667px; color: unset; font-family: unset; font-weight: bold;">image：</span><span style="font-size: 18.6667px; color: unset; font-family: unset;">指定启动</span><span style="font-size: 18.6667px; color: unset; font-family: unset;">容器</span><span style="font-size: 18.6667px; color: unset; font-family: unset;">时的镜像，可以是镜像名称或者镜像ID</span></div></li></ul><div><span style="font-size: 18.6667px;">        例如：image： &quot;redis:latest&quot;</span></div><div><span style="font-size: 18.6667px;">                  image:  &quot;ubuntu:18.04&quot;</span></div><ul><li><div><span style="font-size: 18.6667px; color: unset; font-family: unset; font-weight: bold;">build：</span><span style="font-size: 18.6667px; color: unset; font-family: unset;">指定容器基于哪个dockerfile文件构建的镜像</span></div></li></ul><div><span style="font-size: 14pt;">        例如：build: ./dockerfile</span></div><ul><li><div><span style="font-size: 18.6667px; font-weight: bold;">environment：</span><span style="font-size: 18.6667px;">用于添加环境变量</span></div></li></ul><div><span style="font-size: 14pt;">        例如：environment: </span></div><div><span style="font-size: 14pt;">                         - MYSQL_ROOT_PASSWORD:root</span></div><ul><li><div><span style="font-size: 18.6667px; font-weight: bold;">ports：</span><span style="font-size: 18.6667px;">指定要暴露的端口</span></div></li></ul><div><span style="font-size: 14pt;">        例如：ports: </span></div><div><span style="font-size: 14pt;">                        - &quot;8080:80&quot;</span></div><ul><li><div><span style="font-size: 18.6667px; font-weight: bold;">depends_on：</span><span style="font-size: 18.6667px;">定义容器之间的依耐性关系，解决容器启动的先后问题</span></div></li></ul><div><span style="font-size: 14pt; color: unset; font-family: unset;">        例如：depends_on： </span></div><div><span style="font-size: 14pt; color: unset; font-family: unset;">                         - db</span></div><div><span style="font-size: 14pt; color: unset; font-family: unset;">                         - web</span></div><ul><li><div><span style="font-size: 18.6667px; font-weight: bold;">volumes：</span><span style="font-size: 18.6667px;">指定要挂载的主机路径或者命名卷</span></div></li></ul><div><span style="font-size: 14pt;">        例如：volumes: </span></div><div><span style="font-size: 14pt;">                          - /opt/data:/var/lib/mysql #定义一个绝对路径映射</span></div><div><span style="font-size: 14pt;">                  volumes:</span></div><div><span style="font-size: 14pt;">                          - datavolume:/var/lib/mysql :rw #定义一个具有读写访问权限的命名卷映射，这里的命名卷datavolume还需要在volumes节中定义好！</span></div><ul><li><div><span style="font-size: 18.6667px; font-weight: bold;">command：</span><span style="font-size: 18.6667px;">指定容器启动后默认要运行的命令</span></div></li></ul><div><span style="font-size: 14pt;">        例如：command： </span></div><div><span style="font-size: 14pt;">                         - /bin/bash</span></div><ul><li><div><span style="font-size: 18.6667px; font-weight: bold;">container_name：</span><span style="font-size: 18.6667px;">不使用默认的容器名称，重新定义新的容器名称</span></div></li></ul><div><span style="font-size: 14pt;">         例如：container_name: http-1</span></div><ul><li><div><span style="font-size: 14pt; font-weight: bold;">restart：</span><span style="font-size: 14pt;">定义容器是否随着docker的重启而启动</span></div></li></ul><div><span style="font-size: 14pt;">         例如：restart: </span><span style="font-size: 14pt; color: unset; font-family: unset;">“always”</span></div><ul><li><div><span style="font-size: 14pt; color: unset; font-family: unset; font-weight: bold;">dns: </span><span style="font-size: 14pt; color: unset; font-family: unset;">指定容器要使用的dns地址</span></div></li></ul><div><span style="font-size: 18.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">         例如：dns: </span></div><div><span style="font-size: 18.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">                      - 119.29.29.29</span></div><div><span style="font-size: 18.6667px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: 微软雅黑; font-variant-caps: normal; font-variant-ligatures: normal;">                      - 8.8.8.8</span></div><div><span style="font-size: 14pt; color: rgb(77, 206, 29); font-weight: bold;">任务2.3：使用Docker Compose命令部署和管理应用程序</span></div><ul><li><div><span style="font-size: 14pt; font-weight: bold;">docker -compose  up：</span><span style="font-size: 14pt;">构建镜像，创建启动对应的服务容器，常跟“-d”选项，将容器放到后台运行</span></div></li><li><div><span style="font-size: 18.6667px; font-weight: bold;">docker-compose down：</span><span style="font-size: 18.6667px;">停止容器，并删除由docker-compose up命令创建的容器、网络、存储卷和镜像。</span></div></li></ul><div><br/></div><div><span style="font-size: 16pt; background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">docker-compose上课运行示例：</span></div><div><span style="font-size: 16pt;">eg:</span></div><div><span style="font-size: 16pt;">1）</span><span style="font-size: 16pt;">[root@docker ~]#</span><span style="font-size: 16pt;">docker  run  -d --name test-compose1 -p 8080:80 --restart=always  -e aa=bb -e cc=dd -v /data/nginx/etc/nginx.conf:/etc/nginx/nginx.conf -v /data/nginx/index:/usr/share/nginx/html --dns=119.29.29.29 nginx:latest</span></div><div><span style="font-size: 16pt;">2）</span><span style="font-size: 16pt;">[root@docker ~]#</span><span style="font-size: 16pt;">docker  run  -d --name test-compose2 -p 8090:80 --restart=always  -e aa=bb -e cc=dd -v /data/nginx/etc/nginx.conf:/etc/nginx/nginx.conf -v /data/nginx/index:/usr/share/nginx/html --dns=119.29.29.29  nginx:latest</span></div><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">等同于：</span></div><div><span style="font-size: 16pt;">vim  docker-compose.yml  -&gt;  </span></div><div><span style="font-size: 16pt;">version: '3'</span></div><div><span style="font-size: 16pt;">services:</span></div><div><span style="font-size: 16pt;">   test-compose1:</span></div><div><span style="font-size: 16pt;">      image: &quot;nginx:1.18&quot;</span></div><div><span style="font-size: 16pt;">      restart: &quot;always&quot;</span></div><div><span style="font-size: 16pt;">      ports:</span></div><div><span style="font-size: 16pt;">         - &quot;8080:80&quot;</span></div><div><span style="font-size: 16pt;">      environment:</span></div><div><span style="font-size: 16pt;">         - &quot;aa:bb&quot;</span></div><div><span style="font-size: 16pt;">         - &quot;cc:dd&quot;</span></div><div><span style="font-size: 16pt;">      volumes:</span></div><div><span style="font-size: 16pt;">         - /data/nginx/etc/nginx.conf:/etc/nginx/nginx.conf</span></div><div><span style="font-size: 16pt;">         - /data/nginx/index:/usr/share/nginx/html</span></div><div><span style="font-size: 16pt;">      dns: 119.29.29.29</span></div><div><span style="font-size: 16pt;">   test-compose2:</span></div><div><span style="font-size: 16pt;">      image: &quot;nginx:1.18&quot;</span></div><div><span style="font-size: 16pt;">      restart: &quot;always&quot;</span></div><div><span style="font-size: 16pt;">      ports:</span></div><div><span style="font-size: 16pt;">         - &quot;8090:80&quot;</span></div><div><span style="font-size: 16pt;">      environment:</span></div><div><span style="font-size: 16pt;">         - &quot;aa:bb&quot;</span></div><div><span style="font-size: 16pt;">         - &quot;cc:dd&quot;</span></div><div><span style="font-size: 16pt;">      volumes:</span></div><div><span style="font-size: 16pt;">         - /data/nginx/etc/nginx.conf:/etc/nginx/nginx.conf</span></div><div><span style="font-size: 16pt;">         - /data/nginx/index:/usr/share/nginx/html</span></div><div><span style="font-size: 16pt;">      dns: 119.29.29.29</span></div><div><span style="font-size: 16pt;">#启动docker-compose进行容器编排</span></div><div><span style="font-size: 16pt;">    docker-compose  up  -d</span></div></div></span>
</div></body></html> 