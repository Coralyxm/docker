<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/607246 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="806"/>
<h1>docker容器技术与应用  第16周  笔记</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2023/5/22 15:03</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2023/5/22 15:22</i></td></tr>
<tr><td><b>作者：</b></td><td><i>程露</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><span style="font-size: 21.3333px; color: rgb(209, 0, 255); font-style: italic; font-weight: bold;">（接上一周任务四）</span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255); font-style: italic;">1、</span><span style="color: rgb(209, 0, 255); font-style: italic; font-size: 14pt;">initContainer初始化容器：</span></div><div><span style="color: rgb(209, 0, 255); font-style: italic; font-size: 14pt;">    initContainer会先于containers运行， initcontainer正常退出之后，containers才会启动</span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt; font-weight: bold;">示例一：</span></span></div><div><span style="font-size: 14pt;"><span style="font-size: 14pt;">#在</span></span><span style="font-size: 14pt; color: unset; font-family: unset;">/etc/kubernetes/manifests下，基于yaml资源描述文件，自动部署nginx服务，要求改变index内容为“hello  world”</span></div><div><span style="font-size: 14pt;">[root@master ~]#</span><span style="font-size: 14pt; color: unset; font-family: unset;">cd    /etc/kubernetes/manifests</span></div><div><span style="font-size: 14pt;">[root@master ~]#vim  </span><span style="font-size: 14pt;">cka-initpod.yaml</span></div><div><span style="font-size: 14pt;">apiVersion: v1</span></div><div><span style="font-size: 14pt;">kind: Pod</span></div><div><span style="font-size: 14pt;">metadata:</span></div><div><span style="font-size: 14pt;">  annotations: {}</span></div><div><span style="font-size: 14pt;">  labels:</span></div><div><span style="font-size: 14pt;">    run: cka-initpod</span></div><div><span style="font-size: 14pt;">  name: cka-initpod</span></div><div><span style="font-size: 14pt;">  namespace: default</span></div><div><span style="font-size: 14pt;">spec:</span></div><div><span style="font-size: 14pt;"> <b> initContainers:</b></span></div><div><span style="font-size: 14pt;">  - name: cka-initpod-init</span></div><div><span style="font-size: 14pt;">    image: nginx:1.18</span></div><div><span style="font-size: 14pt;">   <font color="#FF0000"> command:</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">    - &quot;sh&quot;</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">    - &quot;-c&quot;</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">    - 'echo &quot;hello world&quot; &gt; /usr/share/nginx/html/index.html'</font></span></div><div><span style="font-size: 14pt;"> <b> containers:</b></span></div><div><span style="font-size: 14pt;">  - name: cka-initpod</span></div><div><span style="font-size: 14pt;">    image: nginx:1.18</span></div><div><span style="font-size: 14pt;">    resources: {}</span></div><div><span style="font-size: 14pt;">    env:</span></div><div><span style="font-size: 14pt;">    - name: xx</span></div><div><span style="font-size: 14pt;">      value: yy</span></div><div><span style="font-size: 14pt;">    - name: aa</span></div><div><span style="font-size: 14pt;">      value: cc</span></div><div><span style="font-size: 14pt;">    ports:</span></div><div><span style="font-size: 14pt;">    - containerPort: 80</span></div><div><span style="font-size: 14pt;">  dnsPolicy: ClusterFirst</span></div><div><span style="font-size: 14pt;">  restartPolicy: Always</span></div><div><span style="font-size: 14pt;">status: {}</span></div><div><span style="font-size: 14pt;">#查询cka-initpod的IP，并测试网页是否更新为hello world </span></div><div><span style="font-size: 14pt;">[root@master ~]# kubectl get pods -o wide</span></div><div><span style="font-size: 14pt;">NAME                          READY   STATUS    RESTARTS   AGE     IP            NODE     NOMINATED NODE   READINESS GATES</span></div><div><span style="font-size: 14pt;">cka-initpod-master            1/1     Running   0          5h41m   10.244.0.6    master   &lt;none&gt;           &lt;none&gt;</span></div><div><span style="font-size: 14pt;">#使用curl获取主页，发现，主页并未更新</span></div><div><span style="font-size: 14pt;">[root@master ~]# curl <a href="http://10.244.0.6/">http://10.244.0.6</a></span></div><div><span style="font-size: 14pt;">&lt;!DOCTYPE html&gt;</span></div><div><span style="font-size: 14pt;">&lt;html&gt;</span></div><div><span style="font-size: 14pt;">&lt;head&gt;</span></div><div><span style="font-size: 14pt;">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span></div><div><span style="font-size: 14pt;">&lt;style&gt;</span></div><div><span style="font-size: 14pt;">    body {</span></div><div><span style="font-size: 14pt;">        width: 35em;</span></div><div><span style="font-size: 14pt;">        margin: 0 auto;</span></div><div><span style="font-size: 14pt;">        font-family: Tahoma, Verdana, Arial, sans-serif;</span></div><div><span style="font-size: 14pt;">    }</span></div><div><span style="font-size: 14pt;">&lt;/style&gt;</span></div><div><span style="font-size: 14pt;">&lt;/head&gt;</span></div><div><span style="font-size: 14pt;">&lt;body&gt;</span></div><div><span style="font-size: 14pt;">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span></div><div><span style="font-size: 14pt;">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span></div><div><span style="font-size: 14pt;">working. Further configuration is required.&lt;/p&gt;</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;">&lt;p&gt;For online documentation and support please refer to</span></div><div><span style="font-size: 14pt;">&lt;a href=&quot;<a href="http://nginx.org/">http://nginx.org/</a>&quot;&gt;<a href="http://nginx.org/">nginx.org</a>&lt;/a&gt;.&lt;br/&gt;</span></div><div><span style="font-size: 14pt;">Commercial support is available at</span></div><div><span style="font-size: 14pt;">&lt;a href=&quot;<a href="http://nginx.com/">http://nginx.com/</a>&quot;&gt;<a href="http://nginx.com/">nginx.com</a>&lt;/a&gt;.&lt;/p&gt;</span></div><div><span style="font-size: 14pt;"><br/></span></div><div><span style="font-size: 14pt;">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span></div><div><span style="font-size: 14pt;">&lt;/body&gt;</span></div><div><span style="font-size: 14pt;">&lt;/html&gt;</span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255); font-style: italic;">2、使用volumes共享存储卷实现容器的数据共享</span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255);"><i>kubernetes支持的卷类型：</i></span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255);"><i>    * nfs</i></span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255);"><i>    * ceph</i></span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255);"><i>    * glusterfs</i></span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255);"><i><b>    * hostPath（本地路径）</b></i></span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255);"><i><b>    * emptyDir（空路径）</b></i></span></div><div><span style="font-size: 14pt; color: rgb(209, 0, 255);"><i>    * ......</i></span></div><div><span style="font-size: 14pt; font-weight: bold;">示例二：</span></div><div><span style="font-size: 14pt;">#在</span><span style="font-size: 14pt; color: unset; font-family: unset;">/etc/kubernetes/manifests下，基于yaml资源描述文件，自动部署nginx服务，要求<b>基于volumes中hostPath类型共享存储</b>，改变index内容为“hello  world”</span></div><div><span style="font-size: 14pt;">[root@master manifests]# vim cka-volume-pod.yaml</span></div><div><span style="font-size: 14pt;">apiVersion: v1</span></div><div><span style="font-size: 14pt;">kind: Pod</span></div><div><span style="font-size: 14pt;">metadata:</span></div><div><span style="font-size: 14pt;">  annotations: {}</span></div><div><span style="font-size: 14pt;">  labels:</span></div><div><span style="font-size: 14pt;">    run: cka-volume-pod</span></div><div><span style="font-size: 14pt;">  name: cka-volume-pod</span></div><div><span style="font-size: 14pt;">  namespace: default</span></div><div><span style="font-size: 14pt;">spec:</span></div><div><span style="font-size: 14pt;"> <font color="#FF0000"> volumes:</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">  - name: webdir</font></span></div><div><span style="font-size: 14pt;"><font style="color: rgb(255, 0, 0);">    <b>hostPath:</b></font></span></div><div><span style="font-size: 14pt;"><font style="color: rgb(255, 0, 0);">        path: /data/nginx</font></span></div><div><span style="font-size: 14pt;">  initContainers:</span></div><div><span style="font-size: 14pt;">  - name: cka-volume-pod-init</span></div><div><span style="font-size: 14pt;">    image: nginx:1.18</span></div><div><span style="font-size: 14pt;">   <b> </b><font color="#FF0000">volumeMounts:</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">        - name: webdir</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">          mountPath: /usr/share/nginx/html</font></span></div><div><span style="font-size: 14pt;"> <font style="color: rgb(255, 0, 0);">   </font><font>command:</font></span></div><div><span style="font-size: 14pt;">        - &quot;sh&quot;</span></div><div><span style="font-size: 14pt;">        - &quot;-c&quot;</span></div><div><span style="font-size: 14pt;">        - 'echo &quot;hello world&quot; &gt; /usr/share/nginx/html/index.html'</span></div><div><span style="font-size: 14pt;">  containers:</span></div><div><span style="font-size: 14pt;">  - name: cka-volume-pod</span></div><div><span style="font-size: 14pt;">    image: nginx:1.18</span></div><div><span style="font-size: 14pt;"><b>   </b><font color="#FF0000"> volumeMounts:</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">        - name: webdir</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">          mountPath: /usr/share/nginx/html</font></span></div><div><span style="font-size: 14pt;">    resources: {}</span></div><div><span style="font-size: 14pt;">    env:</span></div><div><span style="font-size: 14pt;">    - name: xx</span></div><div><span style="font-size: 14pt;">      value: yy</span></div><div><span style="font-size: 14pt;">    - name: aa</span></div><div><span style="font-size: 14pt;">      value: cc</span></div><div><span style="font-size: 14pt;">    ports:</span></div><div><span style="font-size: 14pt;">    - containerPort: 80</span></div><div><span style="font-size: 14pt;">  dnsPolicy: ClusterFirst</span></div><div><span style="font-size: 14pt;">  restartPolicy: Always</span></div><div><span style="font-size: 14pt;">status: {}</span></div><div><span style="font-size: 14pt;">[root@master ~]# kubectl get pods -o wide</span></div><div><span style="font-size: 14pt;">NAME                          READY   STATUS    RESTARTS   AGE     IP            NODE     NOMINATED NODE   READINESS GATES</span></div><div><span style="font-size: 14pt;">cka-initpod-master            1/1     Running   0          5h41m   10.244.0.6    master   &lt;none&gt;           &lt;none&gt;</span></div><div><span style="font-size: 14pt;">cka-volume-pod-master         1/1     Running   2          15m     10.244.0.11   master   &lt;none&gt;           &lt;none&gt;</span></div><div><span style="font-size: 14pt;">#index文件成功更新为hello world,hostPath共享存储设置成功</span></div><div><span style="font-size: 14pt;">[root@master manifests]# curl <a href="http://10.244.0.11/">http://10.244.0.11</a></span></div><div><span style="font-size: 14pt;">hello world</span></div><div><span style="font-size: 14pt; font-weight: bold;">示例三：</span></div><div><span style="font-size: 14pt;">#在</span><span style="font-size: 14pt; color: unset; font-family: unset;">/etc/kubernetes/manifests下，基于yaml资源描述文件，自动部署nginx服务，要求</span><span style="font-size: 14pt; color: unset; font-family: unset; font-weight: bold;">基于volumes中empthDir类型共享存储</span><span style="font-size: 14pt; color: unset; font-family: unset;">，改变index内容为“hello  world”\</span></div><div><span style="font-size: 14pt;">[root@master manifests]# vim cka-volume-empty-pod.yaml</span></div><div><span style="font-size: 14pt;">apiVersion: v1</span></div><div><span style="font-size: 14pt;">kind: Pod</span></div><div><span style="font-size: 14pt;">metadata:</span></div><div><span style="font-size: 14pt;">  annotations: {}</span></div><div><span style="font-size: 14pt;">  labels:</span></div><div><span style="font-size: 14pt;">    run: cka-volume-empty-pod</span></div><div><span style="font-size: 14pt;">  name: cka-volume-empty-pod</span></div><div><span style="font-size: 14pt;">  namespace: default</span></div><div><span style="font-size: 14pt;">spec:</span></div><div><span style="font-size: 14pt;">  <font color="#FF0000">volumes:</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">  - name: webdir</font></span></div><div><span style="font-size: 14pt;"><font style="color: rgb(255, 0, 0);">    emptyDir: {}</font></span></div><div><span style="font-size: 14pt;">  initContainers:</span></div><div><span style="font-size: 14pt;">  - name: cka-volume-empty-pod-init</span></div><div><span style="font-size: 14pt;">    image: nginx:1.18</span></div><div><span style="font-size: 14pt;">   <font color="#FF0000"> volumeMounts:</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">        - name: webdir</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">          mountPath: /usr/share/nginx/html</font></span></div><div><span style="font-size: 14pt;">    command:</span></div><div><span style="font-size: 14pt;">        - &quot;sh&quot;</span></div><div><span style="font-size: 14pt;">        - &quot;-c&quot;</span></div><div><span style="font-size: 14pt;">        - 'echo &quot;hello world&quot; &gt; /usr/share/nginx/html/index.html'</span></div><div><span style="font-size: 14pt;">  containers:</span></div><div><span style="font-size: 14pt;">  - name: cka-volume-empty-pod</span></div><div><span style="font-size: 14pt;">    image: nginx:1.18</span></div><div><span style="font-size: 14pt;">    <font color="#FF0000">volumeMounts:</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">        - name: webdir</font></span></div><div><span style="font-size: 14pt;"><font color="#FF0000">          mountPath: /usr/share/nginx/html</font></span></div><div><span style="font-size: 14pt;">    resources: {}</span></div><div><span style="font-size: 14pt;">    env:</span></div><div><span style="font-size: 14pt;">    - name: xx</span></div><div><span style="font-size: 14pt;">      value: yy</span></div><div><span style="font-size: 14pt;">    - name: aa</span></div><div><span style="font-size: 14pt;">      value: cc</span></div><div><span style="font-size: 14pt;">    ports:</span></div><div><span style="font-size: 14pt;">    - containerPort: 80</span></div><div><span style="font-size: 14pt;">  dnsPolicy: ClusterFirst</span></div><div><span style="font-size: 14pt;">  restartPolicy: Always</span></div><div><span style="font-size: 14pt;">status: {}</span></div><div><span style="font-size: 14pt;">[root@master manifests]# kubectl get pods -o wide</span></div><div><span style="font-size: 14pt;">NAME                          READY   STATUS    RESTARTS   AGE     IP            NODE     NOMINATED NODE   READINESS GATES</span></div><div><span style="font-size: 14pt;">cka-initpod-master            1/1     Running   0          5h51m   10.244.0.6    master   &lt;none&gt;           &lt;none&gt;</span></div><div><span style="font-size: 14pt;">cka-volume-empty-pod-master   1/1     Running   0          25m     10.244.0.10   master   &lt;none&gt;           &lt;none&gt;</span></div><div><span style="font-size: 14pt;">cka-volume-pod-master         1/1     Running   2          25m     10.244.0.11   master   &lt;none&gt;           &lt;none&gt;</span></div><div><span style="font-size: 14pt;">#index文件成功更新为hello world，</span><span style="font-size: 14pt;">emptyDir</span><span style="font-size: 14pt;">共享存储设置成功</span></div><div><span style="font-size: 14pt;">[root@master manifests]# curl <a href="http://10.244.0.10/">http://10.244.0.10</a>       </span></div><div><span style="font-size: 14pt;">hello world</span></div></span>
</div></body></html> 