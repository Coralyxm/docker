<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/607017 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="792"/>
<h1>docker容器技术与应用  第8周  笔记</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2023/4/3 15:35</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2023/4/3 15:35</i></td></tr>
<tr><td><b>作者：</b></td><td><i>程露</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><div><span style="font-size: 16pt; color: rgb(229, 0, 255); font-style: italic; font-weight: bold;">任务三：学习docker-compose的管理命令</span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">启动容器编排</span></div></li></ul><div><span style="font-size: 16pt;">[root@xserver2 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">up -d</span></div><div><span style="font-size: 16pt;">[+] Running 2/2</span></div><div><span style="font-size: 16pt;">⠿ Container docker-compose-test-compose1-1  Recreated                         0.6s</span></div><div><span style="font-size: 16pt;">⠿ Container nginx-1                         Started                           0.6s</span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">基于某个文件启动容器编排</span></div></li></ul><div><span style="font-size: 16pt;">[root@xserver2 docker-compose]# docker-compose </span><span style="font-size: 16pt; font-weight: bold;"> -f docker-compose.yaml up -d</span></div><div><span style="font-size: 16pt;">[+] Running 2/2</span></div><div><span style="font-size: 16pt;">⠿ Network docker-compose_default  Created                                     0.0s</span></div><div><span style="font-size: 16pt;">⠿ Container nginx-1               Started                                     0.5s</span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">查看编排的容器列表</span></div></li></ul><div><span style="font-size: 16pt;">[root@xserver2 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">ps</span></div><div><span style="font-size: 16pt;">NAME                COMMAND                  SERVICE             STATUS              PORTS</span></div><div><span style="font-size: 16pt;">nginx-1             &quot;/docker-entrypoint.…&quot;   test-compose1       running             0.0.0.0:8080-&gt;80/tcp</span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">查看容器编排进程列表</span></div></li></ul><div><span style="font-size: 16pt;">[root@xserver2 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">top</span></div><div><span style="font-size: 16pt;">nginx-1</span></div><div><span style="font-size: 16pt;">UID    PID     PPID    C    STIME   TTY   TIME       CMD</span></div><div><span style="font-size: 16pt;">root   31698   31681   0    14:05   ?     00:00:00   nginx: master process nginx -g daemon off;   </span></div><div><span style="font-size: 16pt;">101    31780   31698   0    14:05   ?     00:00:00   nginx: worker process                        </span></div><div><span style="font-size: 16pt;">101    31781   31698   0    14:05   ?     00:00:00   nginx: worker process</span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">停止容器编排</span></div></li></ul><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">注意：stop后面不能跟容器名，只能跟services里面的节名</span></div><div><span style="font-size: 16pt;">[root@xserver2 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">stop test-compose1</span></div><div><span style="font-size: 16pt;">[+] Running 1/1</span></div><div><span style="font-size: 16pt;">⠿ Container nginx-1  Stopped    </span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">重启重启编排</span></div></li></ul><div><span style="font-size: 16pt;">[root@xserver2 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">restart</span></div><div><span style="font-size: 16pt;">[+] Running 1/1</span></div><div><span style="font-size: 16pt;">⠿ Container nginx-1  Started  </span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">在其中某个容器上运行某一命令</span></div></li></ul><div><span style="font-size: 16pt;">[root@xserver2 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">run test-compose1 env</span></div><div><span style="font-size: 16pt;">HOSTNAME=f6676c30beca</span></div><div><span style="font-size: 16pt;">HOME=/root</span></div><div><span style="font-size: 16pt;">PKG_RELEASE=1~bullseye</span></div><div><span style="font-size: 16pt;">TERM=xterm</span></div><div><span style="font-size: 16pt;">NGINX_VERSION=1.23.3</span></div><div><span style="font-size: 16pt;">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span></div><div><span style="font-size: 16pt;">NJS_VERSION=0.7.9</span></div><div><span style="font-size: 16pt;">PWD=/</span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">删除容器，但不释放网络、存储等资源</span></div></li></ul><div><span style="font-size: 16pt;">[root@xserver1 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">stop</span> <span style="font-size: 16pt;">test-compose2</span></div><div><span style="font-size: 16pt;">[+] Running 1/1</span></div><div><span style="font-size: 16pt;">⠿ Container nginx-2  Stopped                                                                                                                                                                                      0.2s</span></div><div><span style="font-size: 16pt;">[root@xserver1 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">rm</span> <span style="font-size: 16pt;">test-compose2</span></div><div><span style="font-size: 16pt;">? Going to remove nginx-2 Yes</span></div><div><span style="font-size: 16pt;">[+] Running 1/1</span></div><div><span style="font-size: 16pt;">⠿ Container nginx-2  Removed                                                                                                                                                                                      0.3s</span></div><div><span style="font-size: 16pt;">[root@xserver1 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">down</span> <span style="font-size: 16pt;">test-compose2</span></div><div><span style="font-size: 16pt;">[+] Running 1/1</span></div><div><span style="font-size: 16pt;">⠿ Network docker-compose_default  Removed</span></div><ul><li><div><span style="font-size: 16pt; color: rgb(255, 0, 0);">删除编排的容器/停止容器编排</span></div></li></ul><div><span style="font-size: 16pt;">[root@xserver2 docker-compose]# docker-compose</span> <span style="font-size: 16pt; font-weight: bold;">down</span></div><div><span style="font-size: 16pt;">[+] Running 3/3</span></div><div><span style="font-size: 16pt;">⠿ Container docker-compose_test-compose1_run_b8fc8f94904f  Removed            0.2s</span></div><div><span style="font-size: 16pt;">⠿ Container nginx-1                                        Removed            0.6s</span></div><div><span style="font-size: 16pt;">⠿ Network docker-compose_default                           Removed            0.1s</span></div><div><br/></div><div><span style="font-size: 21.3333px; color: rgb(209, 0, 255); font-style: italic; font-weight: bold;">任务四：通过Docker Compose实现WordPress博客系统的部署（参考教材P140）</span></div><div><span style="font-size: 14pt; font-weight: bold;">一、部署的步骤：</span></div><div><span style="font-size: 14pt;">1、mkdir wordpress &amp;&amp; cd  wordpress</span></div><div><span style="font-size: 14pt;">2、vim docker-compose.yml  -&gt;</span></div><div><span style="font-size: 14pt;">version: &quot;3.3&quot;</span></div><div><span style="font-size: 14pt;">services:</span></div><div><span style="font-size: 14pt;">    db:</span></div><div><span style="font-size: 14pt;">      image: mysql:5.7</span></div><div><span style="font-size: 14pt;">      volumes:</span></div><div><span style="font-size: 14pt;">        - db_data:/var/lib/mysql</span></div><div><span style="font-size: 14pt;">      restart: always</span></div><div><span style="font-size: 14pt;">      environment:</span></div><div><span style="font-size: 14pt;">        MYSQL_ROOT_PASSWORD: 123456</span></div><div><span style="font-size: 14pt;">        MYSQL_DATABASE: wordpress</span></div><div><span style="font-size: 14pt;">        MYSQL_USER: wordpress</span></div><div><span style="font-size: 14pt;">        MYSQL_PASSWORD: wordpress</span></div><div><span style="font-size: 14pt;">    wordpress:</span></div><div><span style="font-size: 14pt;">      depends_on:</span></div><div><span style="font-size: 14pt;">        - db   </span></div><div><span style="font-size: 14pt;">      image: wordpress:latest</span></div><div><span style="font-size: 14pt;">      ports:</span></div><div><span style="font-size: 14pt;">        - &quot;8008:80&quot;</span></div><div><span style="font-size: 14pt;">      restart: always</span></div><div><span style="font-size: 14pt;">      environment:</span></div><div><span style="font-size: 14pt;">        WORDPRESS_DB_HOST: db:3306</span></div><div><span style="font-size: 14pt;">        WORDPRESS_DB_USER: wordpress</span></div><div><span style="font-size: 14pt;">        WORDPRESS_DB_PASSWORD: wordpress</span></div><div><span style="font-size: 14pt;">        WORDPRESS_DB_NAME: wordpress</span></div><div><span style="font-size: 14pt;">volumes:</span></div><div><span style="font-size: 14pt;">    db_data: {}</span></div><div><span style="font-size: 14pt;">3、 docker-compose up -d</span></div><div><span style="font-size: 14pt;">4、浏览器访问：<a href="http://192.168.100.10:8008/">http://192.168.100.10:8008</a></span></div><div><span style="font-size: 14pt; font-weight: bold;">二、查看命名卷在本地的路径：</span></div><div><span style="font-size: 14pt;">1、docker  volume  ls  #查看所有卷标</span></div><div><span style="font-size: 14pt;">2、docker  volume  inspect  $volume_name  #查看卷标的本地真实路径</span></div><div><span style="font-size: 14pt;">     结果：</span><span style="font-size: 14pt;">/var/lib/docker/volumes/wordpress_db_data/_data</span></div><div><span style="font-size: 18.6667px; font-weight: bold;">三、删除容器集群：</span></div><div><span style="font-size: 18.6667px;">在docker-compose工作目录下运行：docker-compose down</span></div><div><br/></div><div><br/></div></div></span>
</div></body></html> 